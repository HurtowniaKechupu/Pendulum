import gym
import numpy as np
import random
import math
env = gym.make('Pendulum-v0')

epsilon = 0.00  #testować gotową macierz na 0.00, wyznaczać nową dla 0.15
gamma = 0.97
alpha = 0.15

podzial_kata = 18
podzial_momentu = 8
podzial_akcji = 5

def oblicz_theta (y,x):
    if (x>0):
        thr = math.acos(y) - math.pi
    else:
        thr = math.pi - math.acos(y)
    thr += math.pi/podzial_kata
    if thr >= math.pi:
        thr = thr - 2*math.pi
    return thr



def aprox(number, amount,max):
    posit = int(math.floor(((number/max)+1)*amount/2))
    return posit


Q_table = np.random.rand(podzial_kata,podzial_momentu,podzial_akcji)    #wypelnienie tabeli q losowo by bez informacji poczatkowej dzialalo
Q_table = Q_table / 100      #podzielenie by wartości sie przypakowo nie zbiegały

#Macierz uczona przez 30 minut:
Q_table = [[[0.0006025195796138749, 7.83862443362381, 0.005424083898811901, 0.0032716039867124124, 0.002536749858900467], [-4.771052785166445, -4.788781733633921, -4.449231917797078, -4.406371209076751, -4.4529206952311915], [-2.769166153367859, -3.0793072185249843, -2.5531599432470538, -2.7331506183733154, -2.672147762774564], [1.265666453174664, 0.8350380607453458, 1.1250515238355359, 1.6161903895571466, 2.4344980886716048], [2.116296874934421, 1.4510056445395878, 1.9586663020684778, 1.4676266307080914, 1.517962186144065], [-1.956761636125369, -1.9809152968571824, -1.8431831125808071, -1.939137633079976, -1.721604533149037], [-4.840275733054731, -4.198245969810728, -4.862034668404841, -5.003418594029554, -4.8998218513795], [0.005315270318066378, 0.004160360599080791, 0.002720939995670182, 0.0015857778985072768, 0.3198017992075386]], [[0.00022504945912880882, 6.151668612196276, 0.0041464289880216495, 0.006664036464054928, 0.00015065092348275132], [-1.8876517899493983, -2.2474970818578894, -1.1315697444854191, -1.6286035507460908, 1.2443890580184809], [-0.3425823671115504, 0.24793601693038003, 0.17777087467964386, 0.06827243130249133, 0.23258750777830717], [2.355869936002299, 1.8579460665657532, 1.8840879667735855, 1.7976013118403884, 1.8483387820341364], [1.7247642360024658, -0.3430204171815893, -0.7803265596334569, 0.2879866581110152, -0.2701987043670126], [-3.9972846980102164, -4.537007591320052, -4.2746233667308795, -4.581631133020607, -4.246295916914917], [-5.854801921406554, -5.808976033295529, -5.82870085505011, -5.8028524564004575, -5.896779827741176], [0.0015536899866020527, 0.0027573704901593856, 0.09454346393461321, 0.002334944586930544, 0.0028462863752817136]], [[-0.044962334807528564, 0.006459048192755754, -0.044863724506390784, 0.015787141339633673, 0.008026516951909958], [0.11599299684181305, 0.8143640383372339, 0.4088740867457849, 0.5500853521426142, 0.8083766411403805], [1.333570171448853, 1.3081625815917035, 1.2652755472957022, 1.3550292828440895, 1.3348946748990378], [1.0441068902365416, -0.5598568876304453, -0.41036816502313345, -0.9762982019374475, -0.7654879156490573], [-3.4693882099357323, -4.1505568857145425, -3.909625122507166, -4.261561201165508, -4.242711166662212], [-4.947307850854528, -4.915558753473301, -4.936963122889607, -4.865390584757693, -4.985895431968142], [-6.432032677860012, -6.390268556991747, -6.387253417609595, -6.394099891235269, -5.954030320731249], [-2.829918696532807, -3.5468754881824114, -3.2627265561469203, -3.10752511169142, -2.8790297331926933]], [[0.18629789883409262, 0.16095365907691664, 0.15473102796464083, 1.0583301374691003, 0.18713811184978008], [0.9162436885842773, 0.7643485909142772, 0.7239989390932428, 0.8992745678860945, 0.8819633263686601], [0.3797476971157616, 1.0676262387103745, 0.2012389237851465, -0.3425578310140804, -0.1816282967161481], [-3.409097950406258, -3.482787079646741, -4.155726521961701, -3.974959102248944, -3.464029173474865], [-4.647707856766205, -4.994276166372462, -5.023780382863688, -5.057624600814789, -5.114436163603841], [-5.323705750817087, -5.017171134286604, -5.354020210017843, -5.3653563816683505, -5.314222936698622], [-6.80657320310064, -6.803197055185999, -5.389777267242026, -6.461778612178095, -6.806533252848294], [-6.62648290156742, -6.624630746039828, -6.618267821518559, -6.643970378491291, -6.600783714158493]], [[0.07713267531671061, 0.31269670281807727, 0.5049390621046272, 0.4790522158303789, 0.3000429212792349], [0.39220075641069263, 0.7183084017268245, 0.08827117769488264, 0.17976929506267733, 0.26062575012684397], [-1.116193351589322, -1.1005339773265315, -2.112576350631854, -1.8363461431195547, -2.8896965250214883], [-4.429408235800682, -4.964376730706568, -4.826608072817086, -4.656595951460351, -5.34079993663153], [-4.990773143749852, -5.608695626965885, -5.766311303995748, -5.499831087110211, -5.53811458072252], [-5.613981151274432, -5.1199347888584095, -5.466536329141028, -5.725516394405196, -5.492989511406787], [-5.978232817501598, -6.490572364667163, -5.856761851888123, -5.340439312346173, -5.906499779883782], [-6.956887854401732, -6.939588591538888, -6.967054296200583, -6.8842984978769515, -6.9379988020813395]], [[-0.1952135309261869, -0.48487207383313224, -0.02935043896272281, -0.21815894876098924, -0.4703795131779629], [-0.1330078473942048, -0.8171617670039729, -0.8714211919200842, -1.6461644466483314, -1.3068068223853726], [-3.0559008811104666, -4.067478379039875, -5.237194406958722, -5.195549275535921, -4.674784525819268], [-5.930103285746409, -5.228218536807843, -5.734523441347528, -5.829217957570369, -5.92965529305302], [-6.1227231373136295, -6.596823967011947, -6.003000784284968, -6.15065640527974, -5.298396497122148], [-5.731403082846697, -6.130376604772114, -6.142062010962295, -5.728678023475637, -5.212075579447691], [-5.758911616517723, -5.632861144107872, -5.171965023040514, -5.628252522047369, -5.5463090499999135], [-7.1164940576421705, -6.957884760159992, -5.429975832435593, -7.111089527801132, -7.1102962478443645]], [[-0.8927217295965901, -1.221057301387045, -1.0730957339237603, -1.0780763621351561, -1.193421559401944], [-0.9458015408361548, -2.937458990208801, -4.28281179791618, -2.925728170044355, -3.8013096886437663], [-5.448586842789855, -5.659019655155738, -5.122861363726748, -5.3735896181954015, -5.75006635693016], [-6.714327347851392, -6.6434611343022665, -6.319500997397818, -6.924075171839471, -6.731830100632097], [-6.70024887655891, -6.952799706196221, -6.8121851329778815, -6.756250405100855, -6.1246328891853485], [-6.403869171322483, -6.551101494260671, -6.467871643458072, -6.4544832033994535, -5.484514966855704], [-5.671276285479771, -5.780080385151136, -5.569929848678862, -5.510650806829283, -5.030610201224155], [-6.372079732141764, -6.050236711621625, -6.06927691170707, -4.999952002104849, -6.032793947971695]], [[-1.8069607070744411, -1.6342169430100062, -2.0856216378363595, -2.0245936151048527, -2.13864872063051], [-2.927128444395371, -4.520552804268667, -4.975734228853991, -4.474861934448875, -4.944024086001796], [-5.942102591768169, -6.780256964783339, -6.7757430736594575, -7.0374821973214345, -6.762113470454202], [-7.923398030487784, -7.899528200484511, -7.92006824052955, -7.719510304531903, -7.906399997183777], [-7.937344294630912, -7.592111637409362, -8.08746509845835, -7.951920406721004, -7.117104528545535], [-6.8092336899765025, -7.039090669330916, -6.942756130394587, -7.056784665197369, -6.130814136787388], [-5.774986822474057, -5.185624642942592, -5.573285968853702, -5.335779420422355, -4.824514458858769], [-4.80026428441093, -5.0661199548911195, -5.097552231847156, -4.9259158257594, -4.6582698907290085]], [[-2.5924385123187705, -3.298647897345483, -3.051465190471791, -3.24001479396122, -3.628251005094139], [-4.84434878517772, -5.23655855359178, -5.087779165027284, -5.348493395481594, -5.525179429825601], [-7.109694182266575, -7.386434954019741, -7.789115751668268, -7.992608981372805, -8.524015966632298], [-9.246500628939796, -9.89913798787384, -10.355375112956166, -9.81101991999839, -10.106183887792831], [-9.601474560361796, -9.714844659657915, -9.606288059934538, -9.577325298959206, -8.252538741370484], [-7.592277368286517, -7.6774249845619895, -7.588932500188289, -7.632851614346242, -7.007397830114703], [-5.396051967760745, -5.619409299902834, -5.6055925468220575, -4.8170133913590565, -4.24838260795209], [-4.262781170571079, -4.427145253202274, -4.353920038629475, -4.244859062175304, -4.0157384692484746]], [[-3.6271703623190974, -4.220922211409273, -3.846863106764055, -4.110965591329516, -3.9176709412740727], [-6.068878910452847, -5.407644721751924, -6.105110250106948, -6.255637392329647, -6.1715636343979305], [-7.711231378172364, -8.628034296783593, -8.75432933522878, -8.533453002094069, -8.670974227943866], [-8.81946641045455, -10.63787837894778, -10.674534346455436, -10.586158565381382, -10.701864352630624], [-10.409695346276713, -10.493112276721838, -10.484556454184219, -10.456486117447168, -9.531649687436321], [-8.152776650400579, -8.089265741285232, -7.969995263484129, -7.943681255889226, -7.66338244823553], [-4.80800835705661, -4.543733110607488, -4.638351512059823, -4.577031132227299, -3.5097352377258804], [-3.531575553776235, -3.3559965415131763, -3.3832561775293, -3.3200290628875138, -3.156287301429623]], [[-5.025475658610066, -4.649895032950678, -5.119936896413786, -5.024823529367256, -4.906053982248476], [-5.698719163709718, -6.260048185566265, -6.318376442733133, -6.231922373066324, -6.238928346597767], [-7.126742630427728, -7.890166044987858, -7.934673896633004, -8.204723515148514, -8.223381821957899], [-8.715686430290061, -9.722641635403622, -10.206126743252224, -10.076851152023362, -10.007040862121263], [-10.263607192870218, -10.518737140794098, -10.549271847653548, -10.396267906472746, -10.557222743488545], [-7.824765433101685, -8.276329773507747, -7.63516226565383, -7.534556184098107, -7.256787145230759], [-5.423173860688996, -3.7175565361718084, -4.047933799920671, -4.29944382768331, -2.846386149739515], [-2.24144342947454, -2.2234918670790575, -2.1918750015924133, -1.9847466057313676, -2.1937988292698094]], [[-5.404941992120969, -5.548611182050015, -5.543705302400672, -5.625125160100682, -5.720262934853002], [-6.145418279871838, -6.110743181723033, -6.090115954080421, -6.245455727047162, -6.3071046861223365], [-6.876365252429362, -7.608923606969368, -7.349879269921519, -7.690645472317661, -7.707839529309218], [-8.370753479026275, -8.250339128119709, -8.194408312493954, -8.334515961639482, -8.513616551590323], [-8.278259122227327, -7.79450973319278, -8.24103803401051, -8.175058179603383, -8.25132222012926], [-7.165056602848717, -6.809172887525125, -6.667435843550012, -6.754674264206302, -6.1498066870851344], [-3.015401945286534, -3.0679240357022817, -3.2599080086799996, -3.142242255453777, -1.75026374446501], [-1.429497315443539, -1.0812558883646952, -1.056972139823207, -1.1038353882826946, -1.0061859036141223]], [[-6.0898212005248835, -5.890871148690403, -6.082956657307163, -6.049042481628837, -6.024015072232654], [-6.005498518842605, -6.060283602503699, -6.189378033122807, -6.188678909173582, -6.237502260130076], [-6.4668572130653175, -6.750002725637405, -6.7474652437721865, -6.785438489544169, -6.750926723189228], [-7.378945969779674, -7.379030595533342, -7.012604206973528, -7.4790698652005485, -7.398756313234415], [-6.906327951652744, -7.091232260969821, -7.118247266171128, -7.128181156532979, -7.090490180340851], [-6.077933177576491, -5.579331826723976, -5.463935239118577, -5.343339196220988, -5.34521574395625], [-1.7508647293714155, -2.631167258868146, -2.011106421802529, -2.1796592955474563, -0.3560049282767288], [-0.29596068247956997, -0.5500570926383279, -0.09612469583220629, -0.11021796644937161, -0.2377193491039915]], [[-6.355453652734097, -6.361210295404898, -6.249866806372453, -6.468121084326487, -6.36150373725768], [-6.265973389412257, -6.088909202477098, -6.262052829546274, -6.313710451663459, -6.2365145918487315], [-6.286915922665508, -6.39189965127443, -6.371180955089616, -6.37779290823912, -6.376397688497239], [-6.492081322822294, -6.520062210802969, -6.317781106699198, -6.492278645318649, -6.511764119534466], [-5.977881369247046, -5.924307755358356, -5.93251487589998, -5.957466361170739, -5.956353060289505], [-3.9700665446262082, -3.947172001200663, -3.636867684186456, -3.811233895300059, -4.060719213461562], [-0.24460481444780058, -0.46648691586270313, 0.5460339050577381, 0.4744401254109577, -0.43536555258526444], [0.40675951274935257, 0.5844675810702673, 0.5560442398997365, 0.6147944724365028, 0.5956469648416114]], [[-6.6151926150465075, -6.674855856211822, -6.626752140291227, -6.3412975706681145, -6.601620285457635], [-6.286873483750634, -6.251097113803192, -6.25942974067939, -6.147206820219105, -6.262848386677043], [-6.147179800802921, -6.02150514540436, -6.149864934960377, -6.148799172458621, -6.146898874947108], [-5.86570664451004, -5.929574568679013, -5.9114299031770425, -5.838872891355603, -5.810333907404291], [-4.988264132456933, -5.017203442096927, -4.993618182784222, -5.167029304413844, -3.879308683642939], [-2.303747644085794, -1.8339494777231629, -0.8300739393974148, -1.7769123319882596, 0.867168060614718], [0.7568896979693407, 1.02941971487588, 1.061914326612941, 1.0591458618648808, 1.0678424927006702], [0.9924848861314047, 0.9445571540751141, 0.4815315027386427, 0.7310368510376531, 0.8243539216125225]], [[-6.158530938546197, -6.127862014503092, -6.167394090398179, -6.137464043193854, -6.1972365144251915], [-6.12094508872811, -6.121568829547018, -6.2215065542168615, -6.12791390146165, -6.096500146859145], [-5.930498934870924, -5.870885729351892, -5.761352352511108, -5.852307169194524, -5.849069799507131], [-5.395882099063056, -5.397553906598989, -5.323039153857677, -5.368693227636132, -5.3714674471275226], [-2.8021032618752706, -3.861872345322004, -3.0976989759326052, -3.0031939033497617, -2.6290179294717655], [0.4031487660946748, 0.3817414689571586, 0.6289828817314861, 0.7297086876909852, 1.0589689922487944], [1.4783875377051496, 1.4333517494684862, 1.4493263064896396, 1.4298868092431132, 1.4510544344376728], [0.016407017546679864, 0.8755350183960563, -0.4918860638767132, -0.5337622247089069, -0.46131755650850115]], [[8.54099056386633, 8.084124813945293, 9.769785908509576, 7.18806454081108, 8.745609347852758], [-6.066389027802147, -6.066451086710721, -5.90084229550609, -6.130061140194174, -6.064056232236123], [-5.433733942106524, -5.389025455720796, -5.448954355763089, -5.383496762733218, -5.33101366581839], [-4.4498611592608395, -4.433396138773928, -4.54667812751397, -4.490728898885792, -4.333929492700668], [-0.05553191663399604, -0.4944530260290957, -0.7980135979131358, 0.5239133895338824, 0.18742855796429267], [1.3807245393537322, 1.3349447996513064, 1.405890495087266, 1.4186976080074176, 1.4269676880427347], [1.3482211535844117, 1.2471688285163438, 1.2562570198979806, 1.0747786210368875, 1.2034585703383023], [-0.5016211226591766, -0.20184352412833112, -0.42347279173226837, -0.2543556181057344, -0.4171288658935385]], [[44.6387241875321, 42.06657453467924, 43.33915857927073, 46.126564516400634, 45.0132037481466], [-5.731304669595395, -5.757317391196906, -5.613804723637094, -5.7209921030432564, -5.759286052380437], [-4.714225170794828, -4.62282700519437, -4.698425190427375, -4.791117306891744, -4.581934642135076], [-1.0826003301405058, -1.163352952142302, -0.5919159836436341, -0.7818665479896456, 2.0583405252782296], [1.4606068313938105, 1.4667237320915274, 1.1576865549319473, 1.6669245438639895, 2.4254395327682747], [1.145464589270001, 0.5492971188307633, 0.5545409639915417, 0.36627867291562677, 0.2959292093120589], [-0.1708113339178805, -2.214054832158201, -2.1897335770946773, -2.490490660994977, -2.6416605604474634], [50.367097824633774, 51.02869408188228, 43.62197908440076, 50.514604797730016, 51.38860916089326]], [[53.23834399873977, 28.278883259499217, 30.445567259066216, 30.870198492938375, 27.96437308989031], [54.52966352262115, 54.666225592714994, 54.65384984094783, 54.51765319096833, 54.65587263199531], [54.565852309292794, 54.092806814165414, 54.036362179950295, 54.22985083280786, 54.18195377206771], [54.1569323100304, 52.39289297572187, 51.81821542449322, 52.78297323890819, 52.93048587147107], [52.34401728090266, 51.218029566527605, 52.6756022146233, 53.92163855167838, 53.24303204250178], [55.635600830644314, 55.00418299153316, 56.15301640160634, 56.55296619701222, 57.84113652629347], [59.50869375765785, 59.729359181456445, 60.01035822897489, 60.93851907776646, 59.90553340324056], [60.51785603217979, 60.57791296892872, 60.50198227345415, 61.073317960147584, 60.58683578489294]], [[5.292730223671905, 6.9028498011323105, 11.095820209586977, 36.63734612184679, 4.014762758009024], [53.668450761580516, 54.282292472464846, 54.22771275813282, 54.53653363311568, 53.42551914463245], [54.509539953789634, 54.585958426870214, 54.54834589800758, 54.56992281246247, 54.32035848851843], [54.515688519563774, 53.879104154578236, 51.72146250632326, 53.56990754274478, 53.941055695509746], [54.393586129626485, 53.08761448993084, 53.97032656101223, 53.0410016351176, 53.30867881054097], [58.50252702505337, 58.04609467699389, 58.47237307722164, 59.26712594848649, 60.837471753621045], [60.677693374795545, 60.85974182942343, 60.66048981083764, 61.5880996936189, 60.807459371966836], [60.82546290021114, 61.5740850636858, 60.82359779608451, 60.97164530583498, 58.40393227143646]], [[14.538723348573559, 3.4212241335481433, -0.3625031577322261, -0.16607653462432576, -0.33258123379796656], [49.414860389399706, 52.21569449342666, 49.053274753011834, 52.083906032076065, 54.48370617461833], [54.48067822346422, 54.58650346404703, 54.242401961657464, 54.60360996070972, 54.435526577684485], [54.733245301622965, 54.491997156182315, 54.56756420992597, 54.46499462850325, 54.486226832883126], [55.44169033396977, 55.857119481284826, 55.92651150263348, 56.47389855495681, 56.99209475431252], [59.17909657082881, 61.076729804416246, 59.87412179842432, 60.46185415064791, 61.388282434906166], [60.71178493719967, 61.00646821545196, 61.066003972275816, 61.74210837724495, 61.20257149499261], [61.30273904689009, 54.264245873089514, 54.12462128061368, 51.117936129624134, 46.4254722120369]], [[0.000822723353181195, 0.007107167747127642, -0.03376720453757508, 0.006228086780599209, 0.0015152025341350927], [42.073974991236966, 39.87105363658473, 39.19460795207687, 54.42490080652996, 40.653147610755916], [54.520337467488524, 54.569767708204836, 54.57609901088344, 54.717317418371294, 54.571505005887495], [55.02926483381617, 54.99440726188532, 54.98953678566778, 55.024373953823655, 55.11231814503648], [58.196893818881684, 57.28824249150176, 58.12245845613953, 60.30509131342616, 58.2913725244738], [61.32103237455398, 61.07933739465256, 61.4364055153047, 60.99668058069692, 60.88863333891049], [61.85103064111687, 61.405817037794876, 60.50337958220885, 60.846822342580325, 60.710706038140906], [11.02581654280122, 11.737135729686932, 21.721011051475134, 43.0126727971171, 8.927608211261209]], [[0.004508009613516511, 0.004308559537603126, 0.0001686838511904032, 0.002510313400884381, 0.004768069835605118], [31.76045210492859, 28.88711432098746, 31.802258391413282, 34.086888394209986, 52.708024174853676], [54.76549797124716, 54.53039030189499, 54.85119356932856, 54.778979362468434, 54.7848259928701], [55.339408187457316, 55.39296269444843, 55.690112127954144, 55.38238775572829, 56.02492165379733], [60.66753854565541, 61.969823562172884, 61.81454708894826, 62.31960914060367, 63.17385542893447], [61.28951391881442, 61.20283528913366, 61.779358344609854, 61.07280417660941, 61.38772443974315], [61.708013378216236, 59.10587857481555, 59.30069004311598, 57.94511328493787, 59.81386351788051], [0.0010415085095704924, 0.0010923759977533032, 5.212183015338208, 0.0015326273479255592, 0.0010381877417365215]], [[0.006633752710315921, 0.004195176747300403, 0.006775111772573582, 0.004739361299367081, 0.005711537626830262], [27.30219745092442, 25.071734884306544, 49.51782661350023, 24.38536774535207, 28.3556157637921], [55.1673292389318, 55.168870572921904, 55.39022108528283, 54.903680394368756, 55.45713026055106], [57.34225624889583, 58.55782981303635, 58.98984857660208, 60.73276669673391, 62.47961921799337], [63.3165925293361, 63.24952360596886, 63.28387066753588, 63.267988538718406, 63.249718062884845], [60.877559731508306, 59.910217642233526, 59.60351877882256, 60.53145384898203, 60.0215829429764], [44.88209274656648, 56.315792471015705, 46.580857612120866, 34.66647726553775, 43.89586571098052], [0.004216415180032974, 0.0023036897413082538, 0.007505386867530946, 0.0006765419098809134, 0.005408779826624317]]]

for i_episode in range(100):

    if np.amax(Q_table) > 10:
        for k in range(0, podzial_kata):
            for m in range(0, podzial_momentu):
                for a in range(0, podzial_akcji):
                    if Q_table[k][m][a] > 0:
                        Q_table[k][m][a] / 10
    if np.amax(Q_table) < -10:
        for k in range(0, podzial_kata):
            for m in range(0, podzial_momentu):
                for a in range(0, podzial_akcji):
                    if Q_table[k][m][a] < 0:
                        Q_table[k][m][a] / 10

    state = env.reset() #reset środowiska
    y = state[0]
    x = state[1]
    th = oblicz_theta(y, x)
    pozycja_th = aprox(th, podzial_kata, math.pi)  # ustalenie pozycji dla kąta w tablicy q
    pozycja_momentu = aprox(state[2], podzial_momentu, 8)  # ustalenie pozycji dla momentu w tablicy q

    for t in range(100):
        env.render()    #render grafiki, chyba najlepsze miejsce
        if random.uniform(0, 1) < epsilon:
            # Wylosuj akcję
            action = env.action_space.sample()
            pozycja_akcji = aprox(action,podzial_akcji,2)
        else:
            # Wybierz najlepszą akcję
            pozycja_akcji = np.argmax(Q_table[pozycja_th][pozycja_momentu])
            action = np.array([float(pozycja_akcji-((podzial_akcji-1)/2))/((podzial_akcji-1)/4)])

        next_state, reward, done, info = env.step(action)
        y = next_state[0]
        x = next_state[1]
        th = oblicz_theta(y,x)
        nowa_pozycja_th = aprox(th, podzial_kata, math.pi)
        nowa_pozycja_momentu = aprox(next_state[2], podzial_momentu, 8)

        if nowa_pozycja_momentu == podzial_momentu:       #dla niektórych wartości środowiska bez tego bloku, dzieje się coś dziwnego, prawdopodobną przyczyną jest konflikt typów
            nowa_pozycja_momentu -= 1
        if pozycja_akcji == podzial_akcji:
            pozycja_akcji -= 1


        Q_value = alpha *((reward+1)/10 + gamma * max(Q_table[nowa_pozycja_th][nowa_pozycja_momentu])- Q_table[pozycja_th][pozycja_momentu][pozycja_akcji])
        Q_table[pozycja_th][pozycja_momentu][pozycja_akcji] += Q_value

        pozycja_th = nowa_pozycja_th
        pozycja_momentu = nowa_pozycja_momentu

        #Kontrola poprawności działania:
        #print(Q_value,action,next_state,reward)
        if done:
            print("Episode finished after {} timesteps".format(t + 1))
            break

#print(Q_table.tolist())
env.close()




